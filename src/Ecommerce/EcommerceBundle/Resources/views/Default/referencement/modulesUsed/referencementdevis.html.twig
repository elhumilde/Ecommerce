{% extends '::layout/layoutAdmin.html.twig' %}


{% block body -%}

    <form class="form-group" action="" method="GET">
        <h4>Mes activités:</h4>
        <textarea></textarea><br>
        selectionner rubrique principale  :
        <select {#class="selectpicker "   multiple data-max-options="1" data-live-search="true"#} id="select-rubrique">
            <option  selected >Selectionné une rubrique</option>
        {% for rubriqu in rubriques %}

            <option value="{{ rubriqu.id }}" >{{ rubriqu.libelle }}</option>
        {% endfor %}
        </select>

<span id="prestaAjax" style="display: none">
        <img src='../../web/ajax-loader.gif' alt='loading...'  height="25" width="25"/>

        </span><select   id="prestation">
            <option  selected >Selectionné une prestation</option>
        </select> <br>

        <div id="test"></div>


{#
        <div style="align-content: center; margin-left:207px">

            <button type="button" class="btn btn-info bouton-1" data-toggle="collapse" data-target="#demo-1">
                Ajouter rubrique suplémentaire &nbsp;   <span class="glyphicon glyphicon-triangle-bottom"></span>
            </button>
<div id="demo-1" class="collapse bouton-2">

            <select #}{#class="selectpicker "   multiple data-max-options="1" data-live-search="true"#}{# id="select-rubrique">
                <option  selected >Selectionné une rubrique</option>
                {% for rubriqu in rubriques %}

                    <option value="{{ rubriqu.id }}" >{{ rubriqu.libelle }}</option>
                {% endfor %}
            </select>


        <select   id="prestation">
            <option  selected >Selectionné une prestation</option>
        </select>



</div>
        </div>#}



    </form>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="http://code.jquery.com/jquery.js"></script>

    <script type="text/javascript">

        jQuery(document).ready(function() {

            var rubrique = jQuery('#select-rubrique');



            jQuery('#select-rubrique').on('change', function () {

                jQuery('#prestaAjax').css('display','');

                console.log("CHANGE rubrique AND prestation....................");
                var select = jQuery(this);
                var r = rubrique.val();
                console.log('rubrique sss: ', r)

           //     console.log('rubrique : ', r);
                var data_send = { 'rubrique': r};
                $.ajax({

                    url: '{{ path('ajax') }}',
                    type: 'POST',
                    data: data_send,
                    statusCode: {


                        //traitement en cas de succès
                        200: function (response) {
                            var successMessage = response;

                    if(response){


                        $('#prestation').children("option").remove();
                        $.each(JSON.parse(successMessage), function(i, pres) {
                            $('#prestation').append(('<option value="' +pres.id+'">'+pres.prestation+'</option>'));
                            jQuery('#prestaAjax').css('display','none');
                        });
                    }  else



                  jQuery('#prestaAjax').css('display','none');


                            //on vide les champs formulaires ou on le supprime ou ...
                            //on retire le loader...
                            //on prévient l'utilistateur du bonne envoi...
                        },
                        //traitement en cas d'erreur (on peut aussi traiter le cas erreur 500...)
                        412: function (response) {
                            var errorsForm = response.responseJSON.formErrors;
                            //on affiche les erreurs...
                            alert('error');
                            jQuery('#prestaAjax').css('display','none');
                        }
                    }

                });


                $( "#select-rubrique" ).clone().appendTo("#test");


            });
        });
  </script>
{% endblock %}
